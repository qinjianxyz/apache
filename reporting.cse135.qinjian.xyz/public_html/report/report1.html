<!DOCTYPE html>
<html lang="en">

<head>
    <title>Static Data Report</title>
    <script src="/collector.js"></script>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script src="https://cdn.zinggrid.com/zinggrid.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<style>
    html,
    body {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
    }

    .chart--container {
        height: 100%;
        width: 100%;
        min-height: 150px;
    }

    #myChart1 {
        width: 100%;
        height: 100%;
        min-height: 250px;
    }

    #myChart2 {
        width: 100%;
        height: 100%;
        min-height: 250px;
    }

    #myChart3 {
        width: 100%;
        height: 100%;
        min-height: 250px;
    }

    .zc-ref {
        display: none;
    }

    .zg-body {
        padding: 20px;
        background: #ffffff;
        font-family: 'Work Sans', sans-serif;
    }

    zing-grid {
        max-width: 700px;
        margin: 0 auto;
        font-family: 'Work Sans', sans-serif;
        border: none;
        font-size: 11px;
        color: #212121;
        border: 1px solid #ddd;
        opacity: 1;
    }

    zing-grid.loading {
        opacity: 0;
        transition: opacity .3s ease-out;
    }

    zing-grid.loading * {
        opacity: 0;
    }

    zg-caption {
        background: #ffffff;
        color: #222222;
        padding: 0px 15px;
        font-size: 18px;
    }

    zg-head {
        letter-spacing: .5px;
        padding-left: 1px;
    }




    .zg-body .user--avatar {
        width: 20px;
        margin-right: 7px;
    }

    .zg-body .recent {
        color: #69B668;
    }

    .zg-body .unknown {
        color: #ACAAAE;
    }

    zg-filter input {
        margin-left: 7px;
    }
</style>

<body>
    <div class="container">
        <a href="/api/secret" class="btn btn-primary">Back</a>
        <h1>Who are my visitors?</h1>
        <div>
            <h2>Event Listeners</h2>
            <p>
                On the day of 15 May 2022, there are <strong><span id="static"></span></strong> static event listener,
                <br>
                <strong><span id="performance"></span></strong> performance event listener triggers, <br>
                and <strong><span id="activity"></span></strong> activity event listener triggers on my site. <br>
                That is <strong><span id="total"></span></strong> total event listener triggers.
            </p>
            <p>
                The event listeners have captured data for the following events:<br>
                screen dimensions, window dimensions, user agent string, default language,
                accept cookies, allow javascript, css, and images, unique identifier
                of the visitor, and the time of the event.
            </p>
        </div>

        <div>
            <h2>Javascript Fingerprinting</h2>
            <p>
                The javascript fingerprinting is a method of identifying a visitor's browser and operating system.<br>
                It is a unique identifier of the visitor. Every visitor has a unique fingerprint generated by the browser.<br>
                More specifically, the user with the unique identifier
                <strong>"45a776b8-0785-4582-a8c6-dceb0a8fc9fe"</strong> has a
                total number of <strong><span id="fingerprint"></span></strong> event listener triggers.
            </p>
        </div>

        <div>
            <h2>Screen & Window Dimensions</h2>
            <p>
                Screen and window dimensions have a tremendous amount of user experience. We strive to understand this
                because we want to make respnsive design that makes the user experience pleasant on all devices. Out of
                all of the device data we recorded, <strong><span id="dimension"></span></strong> out of 
                <strong><span id="total_screen"></span></strong> visits have a screen 
                size smaller than 810,000 squared pixels.
            </p>
        </div>

        <div>
            <h2>Render Permission</h2>
            <p>
                Every page we visit is made up of HTML, CSS, and Javascript. We want to understand how much
                does the user allow us to render the page. Specifically, we want to see if the user allows us to
                have cookies, JavaScript, CSS, and images.<br>
                We have a total of <strong><span id="render"></span></strong> visits that have render permission.<br>
                We have <strong><span id="cookies"></span></strong> visits that have cookies permission.<br>
                We have <strong><span id="javascript"></span></strong> visits that have JavaScript permission.<br>
                We have <strong><span id="css"></span></strong> visits that have CSS permission.<br>
                We have <strong><span id="images"></span></strong> visits that have images permission.
            </p>
        </div>

        <div>
            <h2>Default Language</h2>
            <p>
                We want to understand what the default language is for the user so we can offer better user experience.<br>
                Out of all of the visitors we have recorded, <strong><span id="language"></span></strong>% have a
                default language of English (en-US).<br>
            </p>
        </div>
        
        <div>
            <h3>
                Thanks for reading the report.
            </h3>
        </div>

    </div>

    <script>
        fetch(static_url)
        .then(response => response.json())
        .then(static_data => {
        fetch(performance_url)
        .then(response => response.json())
        .then(performance_data => {
        fetch(activity_url)
        .then(response => response.json())
        .then(activity_data => {

        let totalLength = static_data.length;
        const JavaScriptAllow = static_data.reduce(
        (previousValue, currentValue) => currentValue["allow_js"] ? previousValue + 1 :
        previousValue, 0);
        const ImagesAllow = static_data.reduce(
        (previousValue, currentValue) => currentValue["allow_imgs"] ? previousValue +
        1 : previousValue, 0);
        const CssAllow = static_data.reduce(
        (previousValue, currentValue) => currentValue["allow_css"] ? previousValue + 1 :
        previousValue, 0);

        let english = static_data.filter(data => data["language"] === "en-US");


        let min_val = new Date('May 14, 2022 00:00:00').getTime();
        let step = 3600000; // an hour
        min_val += step * 10;
        let static_calls = [];
        let performance_calls = [];
        let activity_calls = [];
        for (i = 0; i < 24; i++) {
            static_calls.push(static_data.filter(data=> {
                let start = min_val + i * step;
                let end = start + step;
                var time = new Date(data["date"]).getTime();
                return (start < time && time < end);
            }).length);
            performance_calls.push(performance_data.filter(data=> {
                let start = min_val + i * step;
                let end = start + step;
                var time = new Date(data["date"]).getTime();
                return (start < time && time < end);
            }).length);
            activity_calls.push(activity_data.filter(data=> {
                    let start = min_val + i * step;
                    let end = start + step;
                    var time = new Date(data["date"]).getTime();
                    return (start < time && time < end);
            }).length);
        };

        let fingerprint = "45a776b8-0785-4582-a8c5-dceb0a8fc9fe";
        let fingerprint_call = static_data.filter(data=> {
            return data["identifier"] == fingerprint;
        }).length;

        let screen_size = static_data.filter(data=> {
            if (data.screen_dimensions == null) {
                return false;
            }
            return data.screen_dimensions.width * data.screen_dimensions.height < 810000;
        }).length;

        // select element
        let static = document.getElementById("static");
        let performance = document.getElementById("performance");
        let activity = document.getElementById("activity");
        let total = document.getElementById("total");
        let fingerprint_count = document.getElementById("fingerprint");
        let screen = document.getElementById("dimension");
        let total_screen = document.getElementById("total_screen");
        let render = document.getElementById("render");
        let cookies = document.getElementById("cookies");
        let javascript = document.getElementById("javascript");
        let css = document.getElementById("css");
        let images = document.getElementById("images");
        let language = document.getElementById("language");

        // calculate for data
        let static_count = static_calls.reduce((a, b) => a + b, 0);
        let performance_count = performance_calls.reduce((a, b) => a + b, 0);
        let activity_count = activity_calls.reduce((a, b) => a + b, 0);
        total.innerHTML = static_count + performance_count + activity_count;
        static.innerHTML = static_count;
        performance.innerHTML = performance_count;
        activity.innerHTML = activity_count;
        fingerprint_count.innerHTML = fingerprint_call;
        screen.innerHTML = screen_size;
        total_screen.innerHTML = static_data.length;
        render.innerHTML = totalLength;
        cookies.innerHTML = CssAllow;
        javascript.innerHTML = JavaScriptAllow;
        css.innerHTML = CssAllow;
        images.innerHTML = ImagesAllow;
        language.innerHTML = english.length / static_data.length * 100;

    });});});
    </script>


    

    <!--Chart 1-->
    <div style="height: 50px;"></div>
    <div id="myChart1" class="chart--container container h-50">
        <a class="zc-ref" href="https://www.zingchart.com">Powered by ZingChart</a>

    </div>
    <script>
        fetch(static_url)
            .then(response => response.json())
            .then(static_data => {
                fetch(performance_url)
                    .then(response => response.json())
                    .then(performance_data => {
                        fetch(activity_url)
                            .then(response => response.json())
                            .then(activity_data => {
                                let min_val = new Date('May 14, 2022 00:00:00').getTime();
                                let step = 3600000; // an hour
                                min_val += step * 10;
                                let static_calls = [];
                                let performance_calls = [];
                                let activity_calls = [];
                                for (i = 0; i < 24; i++) {
                                    static_calls.push(static_data.filter(data => {
                                        let start = min_val + i * step;
                                        let end = start + step;
                                        var time = new Date(data["date"]).getTime();
                                        return (start < time && time < end);
                                    }).length);
                                    performance_calls.push(performance_data.filter(data => {
                                        let start = min_val + i * step;
                                        let end = start + step;
                                        var time = new Date(data["date"]).getTime();
                                        return (start < time && time < end);
                                    }).length);
                                    activity_calls.push(activity_data.filter(data => {
                                        let start = min_val + i * step;
                                        let end = start + step;
                                        var time = new Date(data["date"]).getTime();
                                        return (start < time && time < end);
                                    }).length);
                                }

                                const myConfig1 = {
                                    "type": "line",
                                    "utc": true,
                                    "title": {
                                        "text": "Event Listener Analytics",
                                        "font-size": "24px",
                                        "adjust-layout": true
                                    },
                                    "plotarea": {
                                        "margin": "dynamic 45 60 dynamic",
                                    },
                                    "legend": {
                                        "layout": "float",
                                        "background-color": "none",
                                        "border-width": 0,
                                        "shadow": 0,
                                        "align": "center",
                                        "adjust-layout": true,
                                        "toggle-action": "remove",
                                        "item": {
                                            "padding": 7,
                                            "marginRight": 17,
                                            "cursor": "hand"
                                        }
                                    },
                                    "scale-x": {
                                        "min-value": min_val,
                                        "shadow": 0,
                                        "step": 3600000,
                                        "transform": {
                                            "type": "date",
                                            "all": "%D, %d %M<br />%h:%i %A",
                                            "item": {
                                                "visible": false
                                            }
                                        },
                                        "label": {
                                            "visible": false
                                        },
                                        "minor-ticks": 0
                                    },
                                    "scale-y": {
                                        "line-color": "#f6f7f8",
                                        "shadow": 0,
                                        "guide": {
                                            "line-style": "dashed"
                                        },
                                        "label": {
                                            "text": "Event Listener Triggers",
                                        },
                                        "minor-ticks": 0,
                                        "thousands-separator": ","
                                    },
                                    "crosshair-x": {
                                        "line-color": "#efefef",
                                        "plot-label": {
                                            "border-radius": "5px",
                                            "border-width": "1px",
                                            "border-color": "#f6f7f8",
                                            "padding": "10px",
                                            "font-weight": "bold"
                                        },
                                        "scale-label": {
                                            "font-color": "#000",
                                            "background-color": "#f6f7f8",
                                            "border-radius": "5px"
                                        }
                                    },
                                    "tooltip": {
                                        "visible": false
                                    },
                                    "plot": {
                                        "highlight": true,
                                        "tooltip-text": "%t views: %v<br>%k",
                                        "shadow": 0,
                                        "line-width": "2px",
                                        "marker": {
                                            "type": "circle",
                                            "size": 3
                                        },
                                        "highlight-state": {
                                            "line-width": 3
                                        },
                                        "animation": {
                                            "effect": 1,
                                            "sequence": 2,
                                            "speed": 100,
                                        }
                                    },
                                    "series": [{
                                            "values": static_calls,
                                            "text": "Static",
                                            "line-color": "#007790",
                                            "legend-item": {
                                                "background-color": "#007790",
                                                "borderRadius": 5,
                                                "font-color": "white"
                                            },
                                            "legend-marker": {
                                                "visible": false
                                            },
                                            "marker": {
                                                "background-color": "#007790",
                                                "border-width": 1,
                                                "shadow": 0,
                                                "border-color": "#69dbf1"
                                            },
                                            "highlight-marker": {
                                                "size": 6,
                                                "background-color": "#007790",
                                            }
                                        },
                                        {
                                            "values": performance_calls,
                                            "text": "Performance",
                                            "line-color": "#009872",
                                            "legend-item": {
                                                "background-color": "#009872",
                                                "borderRadius": 5,
                                                "font-color": "white"
                                            },
                                            "legend-marker": {
                                                "visible": false
                                            },
                                            "marker": {
                                                "background-color": "#009872",
                                                "border-width": 1,
                                                "shadow": 0,
                                                "border-color": "#69f2d0"
                                            },
                                            "highlight-marker": {
                                                "size": 6,
                                                "background-color": "#009872",
                                            }
                                        },
                                        {
                                            "values": activity_calls,
                                            "text": "Activity",
                                            "line-color": "#da534d",
                                            "legend-item": {
                                                "background-color": "#da534d",
                                                "borderRadius": 5,
                                                "font-color": "white"
                                            },
                                            "legend-marker": {
                                                "visible": false
                                            },
                                            "marker": {
                                                "background-color": "#da534d",
                                                "border-width": 1,
                                                "shadow": 0,
                                                "border-color": "#faa39f"
                                            },
                                            "highlight-marker": {
                                                "size": 6,
                                                "background-color": "#da534d",
                                            }
                                        }
                                    ]
                                };

                                zingchart.render({
                                    id: 'myChart1',
                                    data: myConfig1,
                                    height: '100%',
                                    width: '100%'
                                });
                            })
                    })
            });
    </script>

    <zing-grid id="statics-grid" data='' theme="default" caption="Static Data" pager page-size="10"
        page-size-options="10,20,50,200,1000" pager-type="button-arrows" layout-controls="true">

    <script>
        const staticGridRef = document.querySelector('#statics-grid');

        staticGridRef.executeOnLoad(function () {
            fetch(static_url)
                .then(response => response.json())
                .then(data => {
                    staticGridRef.setAttribute('data', JSON.stringify(data));
                })
        });
    </script>

</body>

</html>